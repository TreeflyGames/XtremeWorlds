<?xml version="1.0" encoding="utf-8"?>
<configuration>
    <!-- Enhanced Configuration Root with Versioning and Metadata -->
    <configSections>
        <section name="systemDiagnostics" type="System.Diagnostics.DiagnosticsConfigurationHandler"/>
        <section name="securitySettings" type="System.Security.Configuration.SecurityConfigurationHandler"/>
        <section name="performanceMonitoring" type="System.Diagnostics.PerformanceMonitoringConfigurationHandler"/>
        <section name="telemetry" type="System.Telemetry.ConfigurationHandler"/>
    </configSections>

    <!-- Main Diagnostics System with Advanced Features -->
    <systemDiagnostics version="2.0" environment="production" enabled="true">
        <!-- Source Configuration with Multiple Logging Targets -->
        <sources>
            <source name="DefaultSource" switchName="DefaultSwitch" priority="High">
                <listeners>
                    <add name="FileLog"/>
                    <add name="ConsoleLog"/>
                    <add name="DatabaseLog"/>
                    <add name="CloudLog"/>
                </listeners>
                <metadata>
                    <add key="applicationId" value="APP-001"/>
                    <add key="owner" value="system"/>
                </metadata>
            </source>
            <!-- Additional Specialized Sources -->
            <source name="SecuritySource" switchName="SecuritySwitch">
                <listeners>
                    <add name="SecurityLog"/>
                </listeners>
            </source>
        </sources>

        <!-- Enhanced Switch Configuration -->
        <switches>
            <add name="DefaultSwitch" value="Information" threshold="1000"/>
            <add name="SecuritySwitch" value="Warning" threshold="500"/>
            <add name="VerboseSwitch" value="Verbose" threshold="2000"/>
        </switches>

        <!-- Advanced Listener Configuration -->
        <sharedListeners>
            <!-- File Logging with Rotation and Compression -->
            <add name="FileLog"
                 type="Microsoft.VisualBasic.Logging.FileLogTraceListener, Microsoft.VisualBasic"
                 initializeData="FileLogWriter"
                 baseFileName="application.log"
                 maxFileSizeKB="10240"
                 rotation="daily"
                 compression="gzip"
                 append="true"/>

            <!-- Console Logging with Formatting -->
            <add name="ConsoleLog"
                 type="System.Diagnostics.ConsoleTraceListener"
                 initializeData="ConsoleWriter"
                 format="json"
                 colorCoding="true"/>

            <!-- Database Logging -->
            <add name="DatabaseLog"
                 type="Custom.Diagnostics.DatabaseTraceListener"
                 connectionString="Server=db;Database=logs;Trusted_Connection=True;"
                 tableName="SystemLogs"
                 batchSize="100"/>

            <!-- Cloud Logging Integration -->
            <add name="CloudLog"
                 type="Cloud.Diagnostics.CloudTraceListener"
                 provider="Azure"
                 endpoint="https://logs.azure.com/api"
                 apiKey="YOUR_API_KEY"/>

            <!-- Security Event Logging -->
            <add name="SecurityLog"
                 type="System.Diagnostics.EventLogTraceListener"
                 initializeData="SecurityEvents"
                 category="Security"/>
        </sharedListeners>

        <!-- Error Handling Configuration -->
        <errorHandling>
            <retry policy="exponential" maxAttempts="3" delayMs="500"/>
            <fallback listener="FileLog"/>
            <alert threshold="Critical" email="admin@domain.com"/>
        </errorHandling>
    </systemDiagnostics>

    <!-- Security Configuration -->
    <securitySettings>
        <encryption algorithm="AES-256" key="GENERATED_KEY"/>
        <authentication mode="OAuth2" timeout="3600"/>
        <accessControl>
            <role name="Admin" permissions="Full"/>
            <role name="User" permissions="Read"/>
        </accessControl>
    </securitySettings>

    <!-- Performance Monitoring -->
    <performanceMonitoring enabled="true">
        <metrics>
            <add name="MemoryUsage" interval="5s" threshold="80%"/>
            <add name="CpuUsage" interval="5s" threshold="90%"/>
            <add name="ResponseTime" interval="1s" threshold="200ms"/>
        </metrics>
        <alerts destination="email" recipient="monitor@domain.com"/>
    </performanceMonitoring>

    <!-- Telemetry Configuration -->
    <telemetry enabled="true">
        <collectors>
            <add type="Usage" frequency="hourly"/>
            <add type="Errors" frequency="realtime"/>
            <add type="Performance" frequency="5m"/>
        </collectors>
        <endpoint url="https://telemetry.domain.com/api"/>
        <authentication key="TELEMETRY_KEY"/>
    </telemetry>

    <!-- Runtime Configuration -->
    <runtime>
        <threadPool minThreads="4" maxThreads="16"/>
        <cache sizeMB="512" expiration="30m"/>
        <optimization level="high"/>
    </runtime>
</configuration>
